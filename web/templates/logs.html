<!DOCTYPE html>
<html>
<head>
    <title>Delivery Logs</title>
    <link rel="stylesheet" href="/static/styles.css">
</head>
<body>
    <h1>Delivery Logs for Subscription {{.SubscriptionID}}</h1>
    <a href="/ui/subscriptions">Back to Subscriptions</a>

    <h2>Send Test Webhook</h2>
    <form method="POST" action="/ui/subscriptions/{{.SubscriptionID}}/send" id="send-webhook-form">
    <label>Event Type:<br>
        <input type="text" name="event_type" value="order.created">
    </label><br>
    <label>Payload (JSON):<br>
        <textarea name="payload" rows="4" cols="60">{ "event": "test" }</textarea>
    </label><br>
    <button type="submit">Send Webhook</button>
    </form>

    <h2>Recent Delivery Logs</h2>
<table border="1" cellpadding="5">
    <tr>
        <th>Task ID</th>
        <th>Status</th>
        <th>Timestamp</th>
        <th>Attempt</th>
        <th>Outcome</th>
        <th>HTTP Status</th>
        <th>Error</th>
    </tr>
    <tbody id="logs-body">
    <!-- Logs will be inserted here -->
    </tbody>
</table>

<script>
function fetchLogs() {
    fetch('/api/subscriptions/{{.SubscriptionID}}/logs')
        .then(response => response.json())
        .then(logs => {
            let html = '';
            logs.forEach(log => {
                html += `<tr>
                        <td>${log.DeliveryTaskID}</td>
                        <td>${log.status}</td>
                        <td>${log.Timestamp}</td>
                        <td>${log.AttemptNumber}</td>
                        <td>${log.Outcome}</td>
                        <td>${log.HttpStatus && log.HttpStatus.Valid ? log.HttpStatus.Int64 : '-'}</td>
                        <td>${log.ErrorDetails && log.ErrorDetails.Valid ? log.ErrorDetails.String : '-'}</td>
                    </tr>`;
            });
            document.getElementById('logs-body').innerHTML = html;
        });
}

// Initial fetch and then poll every 5 seconds
fetchLogs();
setInterval(fetchLogs, 5000);
</script>
</body>
</html>